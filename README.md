# OGRA LAB - نظام إدارة المختبر الطبي

## نظرة عامة
OGRA LAB هو نظام شامل لإدارة المختبرات الطبية تم تطويره باستخدام WPF و .NET 8.0. يوفر النظام جميع الوظائف اللازمة لإدارة المرضى، التحاليل، النتائج، والتقارير.

## المتطلبات
- .NET 8.0 SDK أو أحدث
- Windows 10/11
- SQLite (مدمج مع Entity Framework Core)

## المميزات الرئيسية

### إدارة المرضى
- إضافة وتعديل بيانات المرضى
- البحث المتقدم عن المرضى
- تاريخ المرضى الطبي
- إدارة معلومات الاتصال والطوارئ

### إدارة التحاليل
- كتالوج شامل لأنواع التحاليل
- مجموعات التحاليل مع خصومات
- طلبات التحاليل وتتبع الحالة
- إدخال وتحقق النتائج

### إدارة المستخدمين
- نظام مصادقة آمن مع تشفير كلمات المرور
- ثلاث مستويات صلاحيات:
  - **SystemUser**: صلاحيات كاملة بما في ذلك إدارة المستخدمين وسجل الدخول/الخروج
  - **AdminUser**: جميع مهام البرنامج عدا إدارة المستخدمين وسجل الدخول/الخروج
  - **RegularUser**: إضافة مرضى، إدخال نتائج، معاينة وطباعة، تعديل بيانات مرضى (بدون حذف)
- تسجيل تفصيلي لجلسات الدخول والخروج
- واجهة تسجيل دخول أنيقة مع إظهار/إخفاء كلمة المرور

### التقارير والإحصائيات
- تقارير يومية وشهرية
- تقارير الإيرادات
- إحصائيات النظام
- تقارير المرضى والتحاليل

## هيكل المشروع

```
OGRALAB/
├── Models/           # نماذج البيانات
├── Views/            # واجهات المستخدم
├── ViewModels/       # نماذج العرض (MVVM)
├── Services/         # خدمات الأعمال
├── Data/             # DbContext وقاعدة البيانات
├── Helpers/          # أدوات مساعدة
└── README.md
```

## قاعدة البيانات

### الجداول الرئيسية
- **Users**: المستخدمين ومعلومات المصادقة
- **Patients**: بيانات المرضى
- **TestTypes**: أنواع التحاليل
- **TestGroups**: مجموعات التحاليل
- **PatientTests**: طلبات التحاليل
- **TestResults**: نتائج التحاليل
- **LoginLogs**: سجل الدخول والخروج

## التثبيت والإعداد

### 1. استنساخ المشروع
```bash
git clone https://github.com/OGRA-DOCTOR/ogra-lab.git
cd ogra-lab
```

### 2. بناء المشروع
```bash
dotnet restore
dotnet build
```

### 3. تشغيل المشروع
```bash
dotnet run
```

### 4. بيانات المدير الافتراضي
- **اسم المستخدم**: Manager
- **كلمة المرور**: 0000
- **الدور**: SystemUser (صلاحيات كاملة)

⚠️ **تحذير**: يجب تغيير كلمة مرور المدير فور بدء الاستخدام

## 🚀 الحالة الحالية

✅ **المرحلة الأولى - مكتملة**: البنية الأساسية وقاعدة البيانات  
✅ **المرحلة الثانية - مكتملة**: نظام المستخدمين والمصادقة  
✅ **المرحلة الثالثة - مكتملة**: الواجهة الرئيسية ونظام التنقل  
✅ **المرحلة الرابعة - مكتملة**: نظام إدارة المرضى الكامل  
✅ **المرحلة الخامسة - مكتملة**: أنظمة التحاليل والنتائج  
🔄 **المرحلة السادسة - قادمة**: نظام التقارير والطباعة المتقدمة

### المرحلة الرابعة المكتملة:
- ✅ واجهة إضافة/تعديل المريض الكاملة مع جميع الحقول المطلوبة
- ✅ نظام توليد كود المريض التلقائي بصيغة YYYYMMDDXX
- ✅ حقول مخصصة: الجنس (Radio Buttons)، اللقب، السن مع الوحدات
- ✅ بيانات الطبيب مع قوائم منسدلة واقتراحات تلقائية
- ✅ نظام اختيار التحاليل المتقدم مع قائمتين (متاحة/مختارة)
- ✅ واجهة قائمة المرضى مع بحث وتصفية شاملة (بالاسم، رقم المريض، التاريخ)
- ✅ تحديث PatientManagementControl بوظائف حقيقية وإحصائيات مباشرة
- ✅ نظام validation شامل لجميع البيانات المدخلة
- ✅ تطبيق نظام الصلاحيات (RegularUser يضيف/يعدل، لا يحذف)
- ✅ واجهات عربية كاملة مع تصميم متسق وحديث

### المرحلة الخامسة المكتملة:
- ✅ نظام إدخال نتائج التحاليل الكامل مع واجهة احترافية
- ✅ نافذة إدخال النتائج (TestResultEntryWindow) مع قسمين منفصلين
- ✅ نظام التحقق من النطاقات الطبيعية مع ألوان تمييزية
- ✅ عرض التحاليل المعلقة والمكتملة مع حالاتها
- ✅ نظام البحث والتعديل المتقدم (SearchEditControl محدث)
- ✅ بحث متقدم بمعايير متعددة (الاسم، رقم المريض، التاريخ، جهة التحويل)
- ✅ نظام إدارة أنواع التحاليل (TestTypesManagementWindow)
- ✅ إضافة/تعديل/حذف أنواع التحاليل مع النطاقات الطبيعية
- ✅ تحديث ResultEntryControl بوظائف حقيقية بدلاً من placeholder
- ✅ عرض التحاليل المعلقة والنتائج الحديثة مع حالتها
- ✅ ViewModels متخصصة لجميع الوظائف الجديدة
- ✅ Value Converters جديدة لدعم الواجهات المتقدمة
- ✅ تطبيق نظام الصلاحيات على جميع عمليات التحاليل والنتائج

### المرحلة الثالثة المكتملة:
- ✅ واجهة رئيسية محدثة بتصميم حديث وألوان النظام الجديدة
- ✅ نظام تنقل متطور مع قائمة جانبية ديناميكية
- ✅ شريط علوي مع معلومات المستخدم وساعة النظام الحية
- ✅ صفحة ترحيبية جديدة مع إحصائيات وإجراءات سريعة
- ✅ واجهة إدارة المستخدمين الكاملة للمدراء (إضافة، تعديل، حذف، إعادة تعيين كلمة المرور)
- ✅ UserControls أساسية لجميع الأقسام (إدارة المرضى، البحث، إدخال النتائج، التقارير، الإعدادات)
- ✅ نظام ألوان متسق ومتجاوب (أزرق داكن #1e3a8a، برتقالي #f59e0b، أخضر فاتح #10b981)

### المرحلة الثانية المكتملة:
- ✅ نافذة تسجيل دخول أنيقة مع تحقق أمني وإظهار/إخفاء كلمة المرور
- ✅ نظام صلاحيات ثلاثي المستويات (SystemUser, AdminUser, RegularUser)
- ✅ سجل شامل لجميع عمليات الدخول والخروج مع حساب مدة الجلسة
- ✅ واجهة إدارة سجل الدخول مع إمكانيات التصفية والحذف

## الحزم المستخدمة

```xml
<PackageReference Include="Microsoft.EntityFrameworkCore.Sqlite" Version="8.0.0" />
<PackageReference Include="Microsoft.EntityFrameworkCore.Design" Version="8.0.0" />
<PackageReference Include="BCrypt.Net-Next" Version="4.0.3" />
<PackageReference Include="Microsoft.Xaml.Behaviors.Wpf" Version="1.1.39" />
<PackageReference Include="System.ComponentModel.Annotations" Version="5.0.0" />
```

## نمط MVVM
المشروع يتبع نمط Model-View-ViewModel (MVVM) لفصل منطق الأعمال عن واجهة المستخدم:

- **Models**: تمثل بيانات النظام
- **Views**: واجهات المستخدم (XAML)
- **ViewModels**: ربط البيانات ومنطق العرض
- **Services**: منطق الأعمال وعمليات قاعدة البيانات

## الأمان
- تشفير كلمات المرور باستخدام BCrypt
- تسجيل محاولات تسجيل الدخول
- نظام الأدوار والصلاحيات
- حماية من حقن SQL باستخدام Entity Framework

## النسخ الاحتياطي
- النسخ الاحتياطي التلقائي لقاعدة البيانات
- استعادة قاعدة البيانات من النسخ الاحتياطية
- تصدير البيانات بصيغ مختلفة

## التطوير المستقبلي
- [ ] واجهة ويب للوصول عن بُعد
- [ ] تطبيق موبايل للأطباء
- [ ] تكامل مع أجهزة التحليل
- [ ] نظام الإشعارات والتنبيهات
- [ ] تقارير متقدمة وتحليلات
- [ ] ربط مع أنظمة المستشفيات

## المساهمة
نرحب بالمساهمات! يرجى اتباع الخطوات التالية:

1. إنشاء Fork للمشروع
2. إنشاء branch جديد للميزة
3. كتابة الكود مع التعليقات
4. إضافة اختبارات إذا لزم الأمر
5. إرسال Pull Request

## الدعم
للحصول على الدعم أو الإبلاغ عن مشاكل:
- إنشاء Issue في GitHub
- التواصل مع فريق التطوير

## الترخيص
هذا المشروع مرخص تحت [رخصة MIT](LICENSE)

## تاريخ الإصدارات
- **v1.0.0**: الإصدار الأولي مع الوظائف الأساسية
- المزيد قادم...

---

تم تطوير هذا النظام بواسطة فريق OGRA DOCTOR لخدمة المختبرات الطبية.
